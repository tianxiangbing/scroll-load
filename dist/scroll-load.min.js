/*! scroll-load  v1.0.0
* author:tianxiangbing email:
* demo:http://www.lovewebgames.com/jsmodule/scroll-load.html 
* git:  2015-10-15 */
!function(a,b){"function"==typeof define&&define.amd?define(["$","handlebars"],b):"object"==typeof exports?module.exports=b():a.ScrollLoad=b(window.Zepto||window.jQuery||$,window.Handlebars||null)}(this,function(a,b){b&&b.registerHelper("isnodata",function(a,b){return a&&0!=a.length?b.inverse(this):b.fn(this)}),a.fn.ScrollLoad=function(b){var d=[];return a(this).each(function(){var e=new c,f=a.extend({container:a(this)},b);e.init(f),d.push(e)}),d};var c=function(){this.container,this.url,this.param,this.page=1,this.pagename="page",this.loadmore};return c.prototype={init:function(b){if(this.settings=a.extend({scrollLoad:!0,max:20},b),this.load=this.settings.loadmore||a('<div class="ui-loading"><span>下拉查看更多</span><hr/></div>'),this.scrolltrigger=a(this.settings.scrolltrigger||window),this.container=this.settings.container,0==this.container.children().size()&&this.container.append('<div class="scroll-content"/>'),this.container.append(this.load),this.url=this.settings.url,this.page=void 0===this.settings.page?1:this.settings.page,this.pagename=b.pagename||"page",this.param=a.extend({},this.settings.param),this.param[this.pagename]=this.page,this.bindEvent(),this.settings.scrollLoad)this.checkPosition();else{var c=this;setTimeout(function(){c.checkPosition()},3e3)}},touch:function(b,c){var d;a(b).on("click",c),a(b).on("touchmove",function(){d=!0}).on("touchend",function(a){if(a.preventDefault(),!d){var b=c.call(this,a,"touch");b||(a.preventDefault(),a.stopPropagation())}d=!1})},bindEvent:function(){if(this.container.size()){var a=this;a.settings.scrollLoad?a.scrolltrigger.scroll(function(){a.checkPosition()}):a.scrolltrigger.scroll&&a.scrolltrigger.scroll(function(){a.checkPosition()}),a.touch(a.load,function(){a.ajaxData()})}},checkPosition:function(){if(this.page>=this.settings.max)return this.settings.maxCallback&&this.settings.maxCallback.call(this),!1;var b=a(this.container).height(),c=a(this.container).offset().top,d=(this.load.height(),this.scrolltrigger[0].clientHeight||document.documentElement.clientHeight||document.body.clientHeight),e=(this.scrolltrigger[0].clientWidth||document.documentElement.clientWidth||document.body.clientWidth,this.scrolltrigger.scrollTop());d+e>=c+b&&this.ajaxData()},ajaxData:function(){var b=this;return b.ajax||b.end?!1:(b.ajax=!0,this.load.find("span").html("加载中..."),this.param[this.pagename]=this.page,void a.ajax({url:b.url,type:b.settings.type||"get",dataType:"json",cache:b.settings.cache||!1,data:b.param,timeout:3e4,success:function(a){b.settings.format?b.settings.format(b.container,a,b.page):b.format(a),b.page++,b.checkPosition()},complete:function(){b.ajax=!1,b.load.find("span").html("下拉查看更多"),b.page>=b.settings.max&&b.load.hide()}}).done(function(a){a.data&&0==a.data.length&&(b.end=!0)}))},format:function(c){c.data&&0!=c.data.length||1!=this.page||(c.isnodata=!0),c.data&&c.data.length||(c.nodata=!0,this.load.remove());var d="string"==typeof this.settings.tpl?a(this.settings.tpl):this.settings.tpl,e=d.html(),f=b.compile(e),g=f(c);this.container.children().first().append(g),this.settings.callback&&this.settings.callback(this.container,c)},dispose:function(){var b=this;b.load.off("click").off("touchend"),b.load.remove(),b.scrolltrigger.off("scroll"),a(b.scrolltrigger).off("swipeUp")}},c});